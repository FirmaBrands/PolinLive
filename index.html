<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polin Firma Glitch v2</title>
    <style>
        /* --- FONT LOADING --- */
        @font-face {
            font-family: 'Polin';
            /* Ensure this filename matches your file EXACTLY (case-sensitive!) */
            src: url('Polin-Bold.otf') format('opentype');
        }

        body {
            background-color: #0d0d0d;
            color: #e0e0e0;
            font-family: monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        /* --- DISPLAY AREA --- */
        #display-container {
            /* Fallback to Helvetica if Polin fails, so you know it's a font issue */
            font-family: 'Polin', 'Helvetica', sans-serif;
            font-size: 8rem;
            text-align: center;
            margin-bottom: 3rem;
            min-height: 200px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            /* 3D perspective helps the skew effect look cooler */
            perspective: 500px;
        }

        .char {
            display: inline-block;
            transform-style: preserve-3d;
            /* This ensures the font feature swap is immediate, no fading */
            transition: color 0.1s;
            will-change: transform, font-feature-settings;
        }

        /* --- DEBUG & CONTROLS --- */
        .status-bar {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 12px;
            color: #666;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            background: #444;
            border-radius: 50%;
        }

        .controls {
            background: #1a1a1a;
            padding: 20px;
            border: 1px solid #333;
            border-radius: 12px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            width: 80%;
            max-width: 600px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        input[type="text"] {
            grid-column: span 2;
            padding: 12px;
            font-size: 1.5rem;
            background: #000;
            border: 1px solid #555;
            color: #fff;
            text-align: center;
            font-family: 'PolinFirma', sans-serif;
        }

        label {
            color: #888;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
            display: block;
        }

        input[type="range"] {
            width: 100%;
            accent-color: #ff0055;
        }
    </style>
</head>

<body>

    <div class="status-bar">
        <div class="status-dot" id="font-dot"></div>
        <span id="font-status">Checking Font...</span>
    </div>

    <div id="display-container">Firma 2025</div>

    <div class="controls">
        <input type="text" id="input-text" value="Firma 2025">

        <div>
            <label>Glitch Intensity</label>
            <input type="range" id="chance-slider" min="0" max="100" value="40">
        </div>

        <div>
            <label>Speed</label>
            <input type="range" id="speed-slider" min="10" max="1000" value="150">
        </div>

        <div>
            <label>Feature Set (Glyphs)</label>
            <input type="range" id="feature-slider" min="0" max="4" value="4">
        </div>

        <div>
            <label>Physical Distortion</label>
            <input type="range" id="distort-slider" min="0" max="50" value="0">
        </div>
    </div>

    <script>
        // --- 1. FONT CHECKER ---
        document.fonts.ready.then(() => {
            const isLoaded = document.fonts.check('1em PolinFirma');
            const statusText = document.getElementById('font-status');
            const statusDot = document.getElementById('font-dot');

            if (isLoaded) {
                statusText.innerText = "Font Loaded Successfully";
                statusText.style.color = "#4f4";
                statusDot.style.background = "#4f4";
            } else {
                statusText.innerText = "Font Failed! (Check filename/CORS)";
                statusText.style.color = "#f44";
                statusDot.style.background = "#f44";
            }
        });

        // --- 2. SETUP ---
        const container = document.getElementById('display-container');
        const input = document.getElementById('input-text');
        const chanceSlider = document.getElementById('chance-slider');
        const speedSlider = document.getElementById('speed-slider');
        const featureSlider = document.getElementById('feature-slider');
        const distortSlider = document.getElementById('distort-slider');

        // Based on your file dump: ss01-ss04 exist. 
        // We include 'salt' (Alternates) and 'case' just in case.
        const FEATURES = ['"ss01"', '"ss02"', '"ss03"', '"ss04"', '"salt"'];

        let spans = [];
        let interval = null;

        function setupText() {
            container.innerHTML = '';
            spans = [];
            const text = input.value || " ";
            text.split('').forEach(char => {
                const span = document.createElement('span');
                span.textContent = char;
                span.className = 'char';
                if (char === ' ') span.style.width = '0.5em'; // Fix spacing
                container.appendChild(span);
                spans.push(span);
            });
        }

        function glitchFrame() {
            const chance = parseInt(chanceSlider.value) / 100;
            const distortionMax = parseInt(distortSlider.value);
            const featureLimit = parseInt(featureSlider.value);

            spans.forEach(span => {
                // Should this letter glitch?
                if (Math.random() < chance) {

                    // 1. OPEN TYPE FEATURE GLITCH
                    if (featureLimit > 0) {
                        // Pick a random set from 0 to Limit
                        const setIndex = Math.floor(Math.random() * featureLimit);
                        const feat = FEATURES[setIndex] || '"ss01"';
                        span.style.fontFeatureSettings = `${feat} 1`;
                    } else {
                        span.style.fontFeatureSettings = '"liga" 1'; // Reset
                    }

                    // 2. PHYSICAL DISTORTION (CSS Transform)
                    if (distortionMax > 0) {
                        const skewX = (Math.random() - 0.5) * distortionMax; // +/- deg
                        const scaleY = 1 + ((Math.random() - 0.5) * (distortionMax / 50));
                        span.style.transform = `skewX(${skewX}deg) scaleY(${scaleY})`;
                        span.style.color = Math.random() > 0.9 ? '#ff0055' : '#e0e0e0'; // Occasional color flash
                    }

                } else {
                    // RESET TO NORMAL
                    span.style.fontFeatureSettings = '"liga" 1';
                    span.style.transform = 'none';
                    span.style.color = '#e0e0e0';
                }
            });
        }

        function startLoop() {
            if (interval) clearInterval(interval);
            const ms = 1010 - parseInt(speedSlider.value); // Invert slider
            interval = setInterval(glitchFrame, ms);
        }

        // Listeners
        input.addEventListener('input', setupText);
        speedSlider.addEventListener('input', startLoop);

        // Init
        setupText();
        startLoop();

    </script>
</body>

</html>
