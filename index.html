<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MediaBunny Transparency Test</title>
    <script src="https://cdn.jsdelivr.net/npm/mediabunny@latest/dist/index.bundle.min.js"></script>
    <style>
        body { background: #111; color: white; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; gap: 20px; padding: 50px; }
        canvas { border: 1px solid #333; background-image: linear-gradient(45deg, #222 25%, transparent 25%), linear-gradient(-45deg, #222 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #222 75%), linear-gradient(-45deg, transparent 75%, #222 75%); background-size: 20px 20px; }
        button { padding: 10px 20px; cursor: pointer; background: #FF0054; border: none; color: white; border-radius: 4px; font-weight: bold; }
        #status { font-family: monospace; color: #aaa; }
    </style>
</head>
<body>

    <h2>MediaBunny ProRes Alpha Test</h2>
    <canvas id="testCanvas" width="400" height="400"></canvas>
    
    <button id="btnStart">1. GENERATE & EXPORT MOV</button>
    <div id="status">Ready.</div>

    <script>
        const canvas = document.getElementById('testCanvas');
        const ctx = canvas.getContext('2d');
        const status = document.getElementById('status');

        // Draw a simple animated circle with transparency
        function drawFrame(angle) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#FF0054';
            ctx.beginPath();
            ctx.arc(200 + Math.cos(angle) * 100, 200 + Math.sin(angle) * 100, 50, 0, Math.PI * 2);
            ctx.fill();
        }

        document.getElementById('btnStart').onclick = async () => {
            status.innerText = "Initializing MediaBunny...";
            
            try {
                // 1. Initialize Bunny
                const bunny = new MediaBunny();
                await bunny.init();

                const frames = [];
                const totalFrames = 30;

                // 2. Capture frames as Blobs
                status.innerText = "Capturing Frames...";
                for (let i = 0; i < totalFrames; i++) {
                    drawFrame((i / totalFrames) * Math.PI * 2);
                    const blob = await new Promise(res => canvas.toBlob(res, 'image/png'));
                    frames.push(blob);
                }

                // 3. Export to ProRes 4444 (The "Alpha" format)
                status.innerText = "Encoding ProRes 4444...";
                const videoBlob = await bunny.export(frames, {
                    format: 'mov',
                    fps: 30,
                    // Critical parameters for Transparency:
                    args: [
                        '-c:v', 'prores_ks',
                        '-profile:v', '44',        // 4444 profile
                        '-pix_fmt', 'yuva444p10le' // YUV + Alpha
                    ]
                });

                // 4. Download
                const url = URL.createObjectURL(videoBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'transparency_test.mov';
                a.click();
                
                status.innerText = "Done! Check your downloads.";
            } catch (err) {
                console.error(err);
                status.innerText = "Error: " + err.message;
            }
        };

        // Static preview
        drawFrame(0);
    </script>
</body>
</html>
